@using PhishingGame.Blazor.States
@using Radzen.Blazor
@using Radzen

@inherits GameViewBase<FirstRoundState>

<RadzenText TextStyle="TextStyle.H1">@State.RemainingTime.ToString()</RadzenText>
<RadzenFooter Style="display: flex; justify-content: flex-end; gap: 1rem">
    <RadzenButton ButtonStyle="ButtonStyle.Secondary" Click="@Continue">Volgende</RadzenButton>
</RadzenFooter>

@code {
    private CancellationTokenSource _tokenSource;

    public bool CountdownRunning { get; set; }

    protected override void OnParametersSet()
    {
        _tokenSource = new();
        State.CountdownUpdated += OnCountdownChanged;
        State.StartCountDown(_tokenSource.Token);
        CountdownRunning = true;
    }

    private async void OnCountdownChanged()
    {
        await InvokeAsync(StateHasChanged);
    }

    private async Task Continue()
    {
        _tokenSource.Cancel();
        CountdownRunning = false;
        await Session.NextStateAsync();
    }
}

