@using PhishingGame.Blazor.States
@using Radzen.Blazor
@using Radzen

@inherits GameViewBase<EmailCompositionState>

<RadzenStack Style="height:100%"
             AlignItems="AlignItems.Center"
             JustifyContent="JustifyContent.Center">
    <RadzenCard Variant="Variant.Filled">
        <RadzenText TextStyle="TextStyle.DisplayH1">@State.Timer.RemainingTime.ToString()</RadzenText>
    </RadzenCard>
</RadzenStack>

<RadzenFooter Style="display: flex; justify-content: flex-end; gap: 1rem">
    <RadzenButton ButtonStyle="ButtonStyle.Secondary" Click="@Continue">Volgende</RadzenButton>
</RadzenFooter>

@code {

    protected override void OnParametersSet()
    {
        State.Timer.CountdownUpdated += OnCountdownChanged;

        if (State.Timer.Active) return;

        State.StartCountDown();
    }

    private async void OnCountdownChanged()
    {
        await InvokeAsync(StateHasChanged);
    }

    private async Task Continue()
    {
        State.Timer.Active = false;
        await Session.NextStateAsync();
    }
}