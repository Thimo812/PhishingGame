@using PhishingGame.Blazor.States
@using Radzen.Blazor
@using Radzen

@inherits GameViewBase<EmailCompositionState>

<RadzenStack Style="height:100vh"
             AlignItems="AlignItems.Center"
             JustifyContent="JustifyContent.Center">
    <RadzenCard Variant="Variant.Filled">
        <RadzenText TextStyle="TextStyle.DisplayH1">@State.Timer.RemainingTime.ToString()</RadzenText>
    </RadzenCard>
</RadzenStack>

<RadzenFooter Style="display: flex; justify-content: flex-end; gap: 1rem">
    <RadzenButton ButtonStyle="ButtonStyle.Secondary" Click="@Continue">Volgende</RadzenButton>
</RadzenFooter>

@code {
    private CancellationTokenSource _tokenSource;

    protected override void OnParametersSet()
    {
        _tokenSource = new();
        State.Timer.CountdownUpdated += OnCountdownChanged;
        State.StartCountDown(_tokenSource.Token);
    }

    private async void OnCountdownChanged()
    {
        await InvokeAsync(StateHasChanged);
    }

    private async Task Continue()
    {
        _tokenSource.Cancel();
        await Session.NextStateAsync();
    }
}